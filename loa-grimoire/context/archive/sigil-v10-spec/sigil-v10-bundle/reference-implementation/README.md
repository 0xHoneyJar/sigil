# Sigil Soul Engine v10 — Reference Implementation

This is a reference implementation of the Sigil Soul Engine v10 architecture. It provides:

- **Material Core**: Physics-based UI materials (Glass, Clay, Machinery)
- **Interaction Router**: Intent-based sync strategies (CRDT, LWW, Server-Tick)
- **Sync Hooks**: React hooks for each sync strategy
- **Tension System**: Real-time feel adjustment (Playfulness, Weight, Density, Speed)
- **Material Components**: Ready-to-use components that respect material physics

## Installation

```bash
npm install @sigil/soul-engine
# or
yarn add @sigil/soul-engine
# or
pnpm add @sigil/soul-engine
```

## Quick Start

```tsx
import { 
  MaterialProvider, 
  MaterialButton, 
  MaterialCard,
  TensionProvider,
  useServerTick,
  useLocalFirst,
} from '@sigil/soul-engine';

function App() {
  return (
    <TensionProvider initialTensions={{ playfulness: 60, weight: 50 }}>
      <MaterialProvider defaultMaterial="clay">
        <MyComponent />
      </MaterialProvider>
    </TensionProvider>
  );
}

function MyComponent() {
  // Local-first for preferences (instant)
  const { value: theme, update: setTheme } = useLocalFirst('theme', 'dark');
  
  // Server-tick for money (must wait for confirmation)
  const { value: balance, update: withdraw, isPending } = useServerTick('balance', 0);
  
  return (
    <MaterialCard>
      <MaterialButton onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}>
        Toggle Theme (instant)
      </MaterialButton>
      
      <MaterialButton 
        onClick={() => withdraw(balance - 100)}
        disabled={isPending}
      >
        {isPending ? 'Processing...' : 'Withdraw 100 GP'}
      </MaterialButton>
    </MaterialCard>
  );
}
```

## Material Selection

Materials are physics models, not style guides:

| Material | Feel | Use For |
|----------|------|---------|
| `glass` | Light, translucent | Exploratory, discovery |
| `clay` | Warm, tactile | Critical actions, marketing |
| `machinery` | Instant, precise | Command palettes, data tables |

```tsx
// Automatic by zone
<MaterialProvider defaultMaterial="clay">

// Override per component
<MaterialButton materialOverride="machinery">
  Instant Action
</MaterialButton>
```

## Sync Strategy Selection

Match sync to interaction intent:

| Strategy | When | Hook |
|----------|------|------|
| CRDT | Collaborative text | `useCRDTText` |
| LWW | Property state | `useLocalFirst` |
| Server-Tick | Money, health, inventory | `useServerTick` |

```tsx
// Text editing (CRDT)
const { content, insert, presence } = useCRDTText('doc-123');

// Toggle state (LWW - instant)
const { value, update } = useLocalFirst('settings.darkMode', false);

// Money transfer (Server-Tick - must wait)
const { value, update, isPending, error } = useServerTick('balance', 0);
```

## Tension System

Adjust feel in real-time:

```tsx
import { TensionProvider, TensionControlsPanel, useTensions } from '@sigil/soul-engine';

function App() {
  return (
    <TensionProvider initialTensions={{ playfulness: 70 }}>
      <TensionControlsPanel /> {/* Sliders for adjustment */}
      <MyComponent />
    </TensionProvider>
  );
}

function MyComponent() {
  const { tensions, setTension } = useTensions();
  
  // Tensions affect CSS variables automatically
  // --sigil-border-radius, --sigil-transition-duration, etc.
}
```

## Configuration

Create `.sigilrc.yaml` at your project root:

```yaml
version: "10.0"

zones:
  critical:
    material: "clay"
    sync: "server_tick"
    paths:
      - "src/features/checkout/**"

tensions:
  default:
    playfulness: 50
    weight: 50
    density: 50
    speed: 50

gardener:
  paper_cut_threshold: 10
  three_to_one_rule: true
```

## Files

```
src/
├── material/
│   ├── MaterialCore.ts       # Material physics definitions
│   └── MaterialComponents.tsx # React components
├── sync/
│   └── InteractionRouter.ts  # Sync strategy routing
├── hooks/
│   └── useSyncHooks.ts       # React hooks for sync
├── workbench/
│   └── TensionSystem.tsx     # Tension sliders and context
├── config/
│   └── sigilrc.yaml          # Example configuration
└── index.ts                  # Main exports
```

## Philosophy

> "The best products feel like they were crafted by a human, even when generated by a machine."

The Soul Engine is built on six principles:

1. **Material is physics, not styles** — Glass refracts, Clay has weight
2. **Sync by interaction intent** — Text→CRDT, State→LWW, Money→Tick
3. **Vibe coding is real-time** — Tension sliders, instant preview
4. **Garden before feature** — 3:1 paper cuts to features
5. **Studio is multi-role** — Not just one person dictating
6. **Human can override AI** — Bidirectional, not one-way

## License

MIT
