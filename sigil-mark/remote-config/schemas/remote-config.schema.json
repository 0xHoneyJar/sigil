{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sigil.dev/schemas/remote-config.schema.json",
  "title": "Sigil Remote Config Schema",
  "description": "Schema for remote configuration with clear separation between marketing and engineering controlled values.",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version",
      "default": "3.0.0"
    },
    "integration": {
      "$ref": "#/definitions/Integration"
    },
    "marketing_controlled": {
      "$ref": "#/definitions/MarketingControlled"
    },
    "engineering_controlled": {
      "$ref": "#/definitions/EngineeringControlled"
    },
    "fallback_behavior": {
      "$ref": "#/definitions/FallbackBehavior"
    }
  },
  "required": ["version", "marketing_controlled", "engineering_controlled"],
  "definitions": {
    "Integration": {
      "type": "object",
      "description": "Remote config provider integration settings",
      "properties": {
        "provider": {
          "type": "string",
          "description": "Remote config provider",
          "enum": ["local_yaml", "launchdarkly", "statsig", "firebase", "custom"],
          "default": "local_yaml"
        },
        "api_key_env": {
          "type": "string",
          "description": "Environment variable name for API key (never hardcoded)"
        },
        "refresh_interval_ms": {
          "type": "integer",
          "description": "How often to refresh config (0 = manual only)",
          "default": 0
        },
        "timeout_ms": {
          "type": "integer",
          "description": "Timeout for remote fetch",
          "default": 5000
        }
      }
    },
    "MarketingControlled": {
      "type": "object",
      "description": "Values that marketing can modify without engineering approval",
      "properties": {
        "copy": {
          "type": "object",
          "description": "UI copy and messaging",
          "additionalProperties": {
            "$ref": "#/definitions/CopyValue"
          }
        },
        "feature_flags": {
          "type": "object",
          "description": "Feature visibility flags",
          "additionalProperties": {
            "$ref": "#/definitions/FeatureFlag"
          }
        },
        "promotions": {
          "type": "object",
          "description": "Promotional content and banners",
          "additionalProperties": {
            "$ref": "#/definitions/Promotion"
          }
        },
        "survey_triggers": {
          "type": "object",
          "description": "Vibe check trigger enablement",
          "additionalProperties": {
            "type": "boolean"
          }
        }
      }
    },
    "EngineeringControlled": {
      "type": "object",
      "description": "Values that require engineering review to modify",
      "properties": {
        "physics": {
          "type": "string",
          "description": "Physics values are ALWAYS local (never remote)",
          "enum": ["local_only"],
          "default": "local_only"
        },
        "rate_limits": {
          "type": "object",
          "description": "Rate limiting configuration",
          "additionalProperties": {
            "$ref": "#/definitions/RateLimit"
          }
        },
        "timeouts": {
          "type": "object",
          "description": "Timeout values for various operations",
          "additionalProperties": {
            "type": "integer"
          }
        },
        "security_settings": {
          "type": "object",
          "description": "Security-related configuration",
          "additionalProperties": true
        }
      }
    },
    "FallbackBehavior": {
      "type": "object",
      "description": "What to do when remote config is unavailable",
      "properties": {
        "strategy": {
          "type": "string",
          "description": "Fallback strategy",
          "enum": ["local_yaml", "cached", "default", "fail_open", "fail_closed"],
          "default": "local_yaml"
        },
        "cache_ttl_ms": {
          "type": "integer",
          "description": "How long to use cached values",
          "default": 86400000
        },
        "alert_on_fallback": {
          "type": "boolean",
          "description": "Whether to alert when falling back",
          "default": true
        }
      }
    },
    "CopyValue": {
      "type": "object",
      "description": "A piece of UI copy",
      "properties": {
        "value": {
          "type": "string",
          "description": "The copy text"
        },
        "variants": {
          "type": "object",
          "description": "A/B test variants",
          "additionalProperties": {
            "type": "string"
          }
        },
        "zones": {
          "type": "array",
          "description": "Zones where this copy applies",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["value"]
    },
    "FeatureFlag": {
      "type": "object",
      "description": "A feature visibility flag",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether the feature is enabled"
        },
        "rollout_percentage": {
          "type": "number",
          "description": "Percentage of users who see this feature (0-100)",
          "minimum": 0,
          "maximum": 100
        },
        "targeting": {
          "type": "object",
          "description": "Targeting rules for this flag",
          "properties": {
            "personas": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "zones": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "required": ["enabled"]
    },
    "Promotion": {
      "type": "object",
      "description": "A promotional banner or message",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "title": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "cta_text": {
          "type": "string"
        },
        "cta_url": {
          "type": "string"
        },
        "start_date": {
          "type": "string",
          "format": "date-time"
        },
        "end_date": {
          "type": "string",
          "format": "date-time"
        },
        "zones": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["enabled", "title", "message"]
    },
    "RateLimit": {
      "type": "object",
      "description": "Rate limit configuration",
      "properties": {
        "requests_per_minute": {
          "type": "integer"
        },
        "burst_limit": {
          "type": "integer"
        },
        "cooldown_ms": {
          "type": "integer"
        }
      }
    }
  }
}
