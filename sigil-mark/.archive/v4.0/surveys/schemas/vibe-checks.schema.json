{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sigil.dev/schemas/vibe-checks.schema.json",
  "title": "Sigil Vibe Checks",
  "description": "Schema for defining micro-surveys for qualitative feedback",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version",
      "default": "2.6.0"
    },
    "triggers": {
      "type": "array",
      "description": "Survey triggers with questions and options",
      "items": {
        "$ref": "#/definitions/Trigger"
      }
    },
    "feedback": {
      "$ref": "#/definitions/FeedbackConfig"
    },
    "display": {
      "$ref": "#/definitions/DisplayConfig"
    },
    "limits": {
      "$ref": "#/definitions/LimitsConfig"
    }
  },
  "required": ["version", "triggers"],
  "definitions": {
    "Trigger": {
      "type": "object",
      "description": "A survey trigger definition",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the trigger",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "name": {
          "type": "string",
          "description": "Human-readable name"
        },
        "trigger": {
          "type": "string",
          "description": "Event that triggers the survey",
          "enum": [
            "action_completed",
            "error_occurred",
            "first_time",
            "periodic",
            "exit_intent",
            "custom"
          ]
        },
        "trigger_event": {
          "type": "string",
          "description": "Specific event name for custom triggers"
        },
        "question": {
          "type": "string",
          "description": "The survey question"
        },
        "type": {
          "type": "string",
          "description": "Type of response expected",
          "enum": ["scale", "choice", "text", "emoji"],
          "default": "scale"
        },
        "options": {
          "type": "array",
          "description": "Response options (for scale and choice types)",
          "items": {
            "$ref": "#/definitions/Option"
          }
        },
        "cooldown_days": {
          "type": "number",
          "description": "Days to wait before showing again",
          "minimum": 0,
          "default": 7
        },
        "zones": {
          "type": "array",
          "description": "Zones where this trigger applies (empty = all)",
          "items": {
            "type": "string"
          }
        },
        "enabled": {
          "type": "boolean",
          "description": "Whether this trigger is active",
          "default": true
        },
        "priority": {
          "type": "integer",
          "description": "Priority when multiple triggers fire (higher = shown first)",
          "default": 0
        }
      },
      "required": ["id", "trigger", "question"]
    },
    "Option": {
      "type": "object",
      "description": "A response option",
      "properties": {
        "value": {
          "type": ["string", "number"],
          "description": "The value to record"
        },
        "label": {
          "type": "string",
          "description": "Display label"
        },
        "emoji": {
          "type": "string",
          "description": "Emoji to display (for emoji type)"
        }
      },
      "required": ["value", "label"]
    },
    "FeedbackConfig": {
      "type": "object",
      "description": "Configuration for how feedback is recorded",
      "properties": {
        "destination": {
          "type": "string",
          "description": "Where to send feedback",
          "enum": ["console", "file", "endpoint", "custom"],
          "default": "console"
        },
        "endpoint_url": {
          "type": "string",
          "description": "URL for endpoint destination",
          "format": "uri"
        },
        "file_path": {
          "type": "string",
          "description": "Path for file destination"
        },
        "include_context": {
          "type": "boolean",
          "description": "Include zone and persona context",
          "default": true
        },
        "anonymize": {
          "type": "boolean",
          "description": "Anonymize user identifiers",
          "default": true
        }
      }
    },
    "DisplayConfig": {
      "type": "object",
      "description": "Configuration for how surveys are displayed",
      "properties": {
        "position": {
          "type": "string",
          "description": "Where to show the survey",
          "enum": ["bottom-right", "bottom-left", "center", "inline"],
          "default": "bottom-right"
        },
        "delay_ms": {
          "type": "number",
          "description": "Delay before showing (ms)",
          "default": 1000
        },
        "auto_dismiss_ms": {
          "type": "number",
          "description": "Auto-dismiss after (ms), 0 = never",
          "default": 0
        },
        "show_dismiss": {
          "type": "boolean",
          "description": "Show dismiss button",
          "default": true
        },
        "theme": {
          "type": "string",
          "description": "Visual theme",
          "enum": ["light", "dark", "system"],
          "default": "system"
        }
      }
    },
    "LimitsConfig": {
      "type": "object",
      "description": "Rate limiting configuration",
      "properties": {
        "max_per_session": {
          "type": "integer",
          "description": "Maximum surveys per session",
          "default": 2
        },
        "max_per_day": {
          "type": "integer",
          "description": "Maximum surveys per day",
          "default": 3
        },
        "min_interval_minutes": {
          "type": "integer",
          "description": "Minimum minutes between surveys",
          "default": 30
        }
      }
    }
  }
}
