# Sigil Kernel: Fidelity Ceiling
# IMMUTABLE after /codify --lock
# "Better" is often "worse." This protects the soul.

version: "1.0"
locked: false
locked_at: null
locked_by: null

# ═══════════════════════════════════════════════════════════════════════════════
# THE MOD GHOST RULE
# ═══════════════════════════════════════════════════════════════════════════════
#
# When Mod Ghost joined Jagex, he created objectively "better" assets:
# - Smoother gradients
# - Higher polygon counts
# - More detailed textures
#
# The community rejected them because they didn't look like 2007.
#
# The Fidelity Ceiling protects the "jank" that constitutes the soul.
# An AI optimizing for "quality" will destroy the soul.
#
# ═══════════════════════════════════════════════════════════════════════════════

# Agent instruction (injected into crafting-components)
agent_instruction: |
  You are an apprentice in {{era}}.
  You do not know what {{forbidden_techniques | join(', ')}} are.
  You cannot generate {{forbidden_outputs | join(', ')}}.

  If your output looks "better" than the Gold Standard, it is WRONG.
  If your output has more detail than the Gold Standard, it is WRONG.
  If your output is smoother than the Gold Standard, it is WRONG.

  Match the reference. Do not exceed it.

# ═══════════════════════════════════════════════════════════════════════════════
# GOLD STANDARD DEFINITION
# Reference assets that define the quality ceiling
# ═══════════════════════════════════════════════════════════════════════════════

gold_standard:
  description: "Reference assets that define maximum allowed fidelity"
  location: "sigil-mark/gold-standard/"

  # What to include in gold-standard/
  # - Screenshots of reference UI
  # - Example components at correct fidelity
  # - Animation recordings at correct smoothness
  # - Color palettes at correct saturation

  era: "2024"  # Change to match your product's feel

  # Aesthetic references (not actual assets, but guidance)
  references:
    primary:
      - name: "Linear"
        why: "Stark, fast, no decoration"
      - name: "Stripe Dashboard"
        why: "Clean shadows, subtle depth"

    anti_references:
      - name: "Dribbble shots"
        why: "Over-designed, not functional"
      - name: "Neumorphism"
        why: "Too soft, illegible"

# ═══════════════════════════════════════════════════════════════════════════════
# FIDELITY CONSTRAINTS
# Specific limits on generated output
# ═══════════════════════════════════════════════════════════════════════════════

constraints:
  # ─────────────────────────────────────────────────────────────────────────────
  # Visual Complexity
  # ─────────────────────────────────────────────────────────────────────────────
  visual:
    gradients:
      max_stops: 2
      allowed_types: ["linear", "radial"]
      forbidden: ["mesh", "conic with >3 stops"]
      reason: "Complex gradients feel over-designed"

    shadows:
      max_layers: 3
      max_blur_px: 24
      forbidden: ["inset shadows on buttons", "colored shadows"]
      reason: "Too many shadow layers feel heavy"

    borders:
      max_width_px: 2
      allowed_styles: ["solid", "none"]
      forbidden: ["dashed", "dotted", "double", "gradient borders"]
      reason: "Decorative borders distract"

    border_radius:
      max_px: 16
      forbidden: ["asymmetric radius", "pill on non-pills"]
      reason: "Excessive rounding feels childish"

    colors:
      max_palette_size: 12
      saturation:
        min: 0
        max: 80  # Prevent neon
      forbidden: ["neon", "pure black (#000)", "pure white (#FFF)"]
      reason: "Oversaturated colors feel cheap"

  # ─────────────────────────────────────────────────────────────────────────────
  # Animation Complexity
  # ─────────────────────────────────────────────────────────────────────────────
  animation:
    max_duration_ms: 800
    max_properties_animated: 3
    forbidden_effects:
      - "3D transforms (rotateX, rotateY)"
      - "Perspective transforms"
      - "Motion blur"
      - "Particle effects"
      - "Confetti (unless explicitly approved)"
      - "Morphing shapes"

    easing:
      allowed: ["ease-out", "ease-in-out", "spring", "step-end"]
      forbidden: ["bounce", "elastic (unless approved)"]

    reason: "Complex animations feel gratuitous"

  # ─────────────────────────────────────────────────────────────────────────────
  # Typography Complexity
  # ─────────────────────────────────────────────────────────────────────────────
  typography:
    max_font_families: 2
    max_font_weights: 4
    forbidden:
      - "Decorative fonts in UI"
      - "Fonts below 12px"
      - "Letter-spacing on body text"
      - "All-caps for more than 3 words"

    reason: "Typography tricks distract from content"

  # ─────────────────────────────────────────────────────────────────────────────
  # Layout Complexity
  # ─────────────────────────────────────────────────────────────────────────────
  layout:
    max_nesting_depth: 4
    forbidden:
      - "Overlapping elements (unless modal)"
      - "Fixed elements (except nav/toolbar)"
      - "Horizontal scroll (except carousels)"

    reason: "Complex layouts create cognitive load"

  # ─────────────────────────────────────────────────────────────────────────────
  # Icon Complexity
  # ─────────────────────────────────────────────────────────────────────────────
  icons:
    style: "outline"  # or "solid", "duotone"
    stroke_width: 1.5
    max_colors: 2
    forbidden:
      - "Illustrated icons in UI"
      - "Gradient fills"
      - "Drop shadows on icons"

    reason: "Icons should be functional, not decorative"

# ═══════════════════════════════════════════════════════════════════════════════
# VIOLATION DETECTION
# How to identify fidelity violations
# ═══════════════════════════════════════════════════════════════════════════════

detection:
  # Patterns that suggest fidelity violation
  warning_patterns:
    - pattern: "gradient.*stop.*stop.*stop"
      message: "Gradient has too many stops"
      severity: "warn"

    - pattern: "box-shadow.*,.*,.*,.*,"
      message: "Too many shadow layers"
      severity: "warn"

    - pattern: "animation.*3s|animation.*4s|animation.*5s"
      message: "Animation too long"
      severity: "warn"

    - pattern: "transform.*rotate(X|Y|Z)"
      message: "3D transform detected"
      severity: "error"

    - pattern: "perspective"
      message: "Perspective transform detected"
      severity: "error"

    - pattern: "filter.*blur.*blur"
      message: "Multiple blur filters"
      severity: "warn"

  # Auto-reject patterns
  reject_patterns:
    - pattern: "background.*mesh-gradient"
      message: "Mesh gradients forbidden"

    - pattern: "animation.*bounce|animation.*elastic"
      message: "Bounce/elastic animations require approval"

    - pattern: "@keyframes.*rotate3d"
      message: "3D keyframe animations forbidden"

# ═══════════════════════════════════════════════════════════════════════════════
# FORBIDDEN TECHNIQUES
# Things the AI should "not know"
# ═══════════════════════════════════════════════════════════════════════════════

forbidden_techniques:
  - "Ambient Occlusion"
  - "Mesh Gradients"
  - "3D Transforms"
  - "Particle Systems"
  - "Motion Blur"
  - "Morphing Animations"
  - "Glassmorphism with grain"
  - "Claymorphism"
  - "Neumorphism"
  - "Aurora Backgrounds"
  - "Liquid Metal Effects"

forbidden_outputs:
  - "Textures above 256x256"
  - "SVGs with >50 path elements"
  - "Animations longer than 800ms"
  - "Gradients with >2 stops"
  - "Shadow stacks with >3 layers"
  - "Nested border-radius"
  - "Variable fonts with >3 axes"

# ═══════════════════════════════════════════════════════════════════════════════
# RETRO/PIXEL MODE
# For OSRS-style products
# ═══════════════════════════════════════════════════════════════════════════════

retro_mode:
  enabled: false  # Enable for pixel-art products

  constraints:
    polygon_count:
      max: 500
      per: "asset"

    texture_resolution:
      max_width: 64
      max_height: 64

    color_depth: "indexed_256"

    animation_frames:
      max: 8
      per: "action"

    tick_rate_ms: 600

  agent_instruction: |
    You are an apprentice in 2007.
    You do not know what Ambient Occlusion is.
    You cannot generate textures above 64x64.
    Your models cannot exceed 500 polygons.
    Animations have maximum 8 frames.
    All state changes align to 600ms ticks.

    If your output looks "modern," it is WRONG.
    Match the Varrock West Bank, not Elden Ring.

# ═══════════════════════════════════════════════════════════════════════════════
# VALIDATION RULES
# For validating-fidelity agent
# ═══════════════════════════════════════════════════════════════════════════════

validation:
  on_generate:
    - check: "gradient_complexity"
      max: 2
      action: "warn"

    - check: "shadow_layers"
      max: 3
      action: "warn"

    - check: "animation_duration"
      max_ms: 800
      action: "warn"

    - check: "forbidden_techniques"
      action: "reject"

  on_approve:
    - check: "gold_standard_comparison"
      action: "flag_if_exceeds"

    - check: "constraint_violations"
      action: "require_justification"

# ═══════════════════════════════════════════════════════════════════════════════
# EXCEPTIONS
# When higher fidelity is allowed
# ═══════════════════════════════════════════════════════════════════════════════

exceptions:
  allowed_zones:
    - zone: "marketing"
      relaxed_constraints:
        - "animation_duration: 1200ms"
        - "gradient_stops: 3"
      reason: "Marketing can be more expressive"

    - zone: "celebration"
      relaxed_constraints:
        - "confetti: allowed"
        - "particle_effects: limited"
      reason: "Celebrations warrant extra polish"

  approval_required:
    - "Any 3D transforms"
    - "Any elastic/bounce easing"
    - "Any particle effects"
    - "Any mesh gradients"
    - "Any motion longer than 800ms"
