{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sigil.dev/schemas/constitution.schema.json",
  "title": "Sigil Constitution",
  "description": "Protected capabilities that ALWAYS work, regardless of remote config, marketing campaigns, A/B tests, lens selection, or user preferences.",
  "type": "object",
  "required": ["version", "protected"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Constitution schema version",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "enforcement": {
      "type": "string",
      "description": "Default enforcement level for all capabilities",
      "enum": ["block", "warn", "log"],
      "default": "block"
    },
    "protected": {
      "type": "array",
      "description": "List of protected capabilities",
      "items": {
        "$ref": "#/definitions/ProtectedCapability"
      }
    },
    "override_audit": {
      "$ref": "#/definitions/OverrideAuditConfig"
    }
  },
  "definitions": {
    "ProtectedCapability": {
      "type": "object",
      "required": ["id", "name", "description", "enforcement", "rationale"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the capability (e.g., 'withdraw', 'deposit')",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "name": {
          "type": "string",
          "description": "Human-readable name"
        },
        "description": {
          "type": "string",
          "description": "What this capability does"
        },
        "enforcement": {
          "type": "string",
          "description": "How to handle violations",
          "enum": ["block", "warn", "log"]
        },
        "rationale": {
          "type": "string",
          "description": "Why this capability is protected"
        },
        "zones": {
          "type": "array",
          "description": "Zones where this capability applies (empty = all zones)",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "OverrideAuditConfig": {
      "type": "object",
      "description": "Configuration for auditing override attempts",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether to audit override attempts",
          "default": true
        },
        "path": {
          "type": "string",
          "description": "Path to write audit logs"
        },
        "requires_justification": {
          "type": "boolean",
          "description": "Whether overrides require a justification",
          "default": true
        },
        "notify": {
          "type": "array",
          "description": "Stakeholders to notify on override",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
