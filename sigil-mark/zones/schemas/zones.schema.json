{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sigil.dev/schemas/zones.schema.json",
  "title": "Sigil Zones Schema v4.0",
  "description": "Schema for defining zones with journey context, persona mapping, and trust states. Zones are layout-based (CriticalZone, MachineryLayout, GlassLayout).",
  "type": "object",
  "additionalProperties": {
    "$ref": "#/definitions/Zone"
  },
  "definitions": {
    "Zone": {
      "type": "object",
      "description": "A zone representing a context for UI with journey and persona context",
      "properties": {
        "paths": {
          "type": "array",
          "description": "File path globs for agent-time zone detection (v4.0)",
          "items": {
            "type": "string"
          }
        },
        "layout": {
          "type": ["string", "null"],
          "description": "Layout component name (CriticalZone, MachineryLayout, GlassLayout, or null)",
          "enum": ["CriticalZone", "MachineryLayout", "GlassLayout", null]
        },
        "timeAuthority": {
          "type": "string",
          "description": "Time authority for state management",
          "enum": ["server-tick", "optimistic"],
          "default": "optimistic"
        },
        "time_authority": {
          "type": "string",
          "description": "Time authority for state management (snake_case alias)",
          "enum": ["server-tick", "optimistic"],
          "default": "optimistic"
        },
        "lens": {
          "type": "string",
          "description": "Default lens for this zone",
          "enum": ["default", "strict", "guided", "a11y", "user-preference"]
        },
        "motion": {
          "type": "string",
          "description": "Motion style for this zone",
          "enum": ["snappy", "deliberate", "warm", "reassuring", "playful", "reduced"]
        },
        "constraints": {
          "$ref": "#/definitions/ZoneConstraints"
        },
        "journey_stage": {
          "type": "string",
          "description": "The user journey stage this zone represents (v4.0)"
        },
        "persona_likely": {
          "type": "string",
          "description": "Most likely persona in this zone (v4.0)"
        },
        "trust_state": {
          "type": "string",
          "description": "Trust state for this zone context (v4.0)",
          "enum": ["building", "established", "critical"]
        },
        "default_persona": {
          "type": "string",
          "description": "Default persona ID for this zone"
        },
        "persona_overrides": {
          "type": "object",
          "description": "Persona-specific overrides for this zone",
          "additionalProperties": {
            "$ref": "#/definitions/PersonaOverride"
          }
        },
        "evidence": {
          "type": "array",
          "description": "Evidence citations for zone configuration (v4.0)",
          "items": {
            "type": "string"
          }
        },
        "last_refined": {
          "type": "string",
          "description": "ISO date when zone was last refined (v4.0)",
          "format": "date"
        }
      }
    },
    "ZoneConstraints": {
      "type": "object",
      "description": "Constraints for UI patterns in this zone",
      "properties": {
        "optimistic_ui": {
          "type": "string",
          "description": "Whether optimistic UI updates are allowed",
          "enum": ["allowed", "warn", "forbidden"]
        },
        "loading_spinners": {
          "type": "string",
          "description": "Whether loading spinners are allowed",
          "enum": ["allowed", "warn", "forbidden"]
        },
        "animations": {
          "type": "string",
          "description": "Whether animations are allowed",
          "enum": ["allowed", "warn", "forbidden"]
        },
        "raw_physics": {
          "type": "string",
          "description": "Whether raw physics calculations are allowed",
          "enum": ["allowed", "warn", "forbidden"]
        }
      }
    },
    "PersonaOverride": {
      "type": "object",
      "description": "Persona-specific overrides within a zone",
      "properties": {
        "lens": {
          "type": "string",
          "description": "Override lens for this persona in this zone",
          "enum": ["default", "strict", "guided", "a11y"]
        },
        "help": {
          "type": "string",
          "description": "Override help preference",
          "enum": ["always", "on_demand", "contextual", "never"]
        },
        "density": {
          "type": "string",
          "description": "Override information density",
          "enum": ["high", "medium", "low"]
        },
        "motion": {
          "type": "string",
          "description": "Override motion style",
          "enum": ["snappy", "deliberate", "warm", "reassuring", "reduced"]
        }
      }
    }
  }
}
