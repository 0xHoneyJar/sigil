{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sigil.dev/schemas/lens-array.schema.json",
  "title": "Sigil Lens Array",
  "description": "Schema for defining user personas with physics and constraints",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version",
      "default": "2.6.0"
    },
    "lenses": {
      "type": "object",
      "description": "Map of persona ID to persona definition",
      "additionalProperties": {
        "$ref": "#/definitions/Persona"
      }
    },
    "immutable_properties": {
      "type": "array",
      "description": "Properties that cannot be overridden when stacking lenses",
      "items": {
        "type": "string"
      },
      "default": []
    },
    "stacking": {
      "$ref": "#/definitions/StackingConfig"
    }
  },
  "required": ["version", "lenses"],
  "definitions": {
    "Persona": {
      "type": "object",
      "description": "A user persona with its physics and constraints",
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable name for the persona"
        },
        "alias": {
          "type": "string",
          "description": "Short alias or nickname (e.g., 'Chef', 'Henlocker')"
        },
        "description": {
          "type": "string",
          "description": "Description of who this persona represents"
        },
        "physics": {
          "$ref": "#/definitions/PersonaPhysics"
        },
        "constraints": {
          "$ref": "#/definitions/PersonaConstraints"
        },
        "priority": {
          "type": "integer",
          "description": "Priority for conflict resolution (higher wins)",
          "default": 0
        }
      },
      "required": ["name", "alias", "physics", "constraints"]
    },
    "PersonaPhysics": {
      "type": "object",
      "description": "Physical interaction requirements for the persona",
      "properties": {
        "tap_targets": {
          "type": "object",
          "description": "Minimum tap target sizes",
          "properties": {
            "min_size": {
              "type": "string",
              "description": "Minimum size (e.g., '44px', '48px')"
            },
            "spacing": {
              "type": "string",
              "description": "Minimum spacing between targets"
            }
          }
        },
        "input_method": {
          "type": "string",
          "description": "Primary input method",
          "enum": ["keyboard", "mouse", "touch", "mixed", "voice"]
        },
        "shortcuts": {
          "type": "object",
          "description": "Whether keyboard shortcuts are expected",
          "properties": {
            "expected": {
              "type": "boolean",
              "default": false
            },
            "required": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Required shortcut patterns"
            }
          }
        },
        "motion": {
          "type": "object",
          "description": "Motion and animation preferences",
          "properties": {
            "reduced": {
              "type": "boolean",
              "description": "Whether to reduce motion",
              "default": false
            },
            "duration_multiplier": {
              "type": "number",
              "description": "Multiplier for animation durations",
              "default": 1.0
            }
          }
        },
        "feedback": {
          "type": "object",
          "description": "Feedback preferences",
          "properties": {
            "haptic": {
              "type": "boolean",
              "description": "Whether haptic feedback is expected"
            },
            "audio": {
              "type": "boolean",
              "description": "Whether audio feedback is expected"
            },
            "visual": {
              "type": "boolean",
              "description": "Whether visual feedback is required",
              "default": true
            }
          }
        }
      },
      "required": ["input_method"]
    },
    "PersonaConstraints": {
      "type": "object",
      "description": "Constraints and limitations for the persona",
      "properties": {
        "max_actions_per_screen": {
          "type": "integer",
          "description": "Maximum primary actions visible per screen"
        },
        "reading_level": {
          "type": "string",
          "description": "Expected reading comprehension level",
          "enum": ["basic", "standard", "advanced"]
        },
        "session_duration": {
          "type": "string",
          "description": "Expected session duration",
          "enum": ["brief", "moderate", "extended"]
        },
        "error_tolerance": {
          "type": "string",
          "description": "Tolerance for errors and friction",
          "enum": ["low", "medium", "high"]
        },
        "cognitive_load": {
          "type": "string",
          "description": "Acceptable cognitive load level",
          "enum": ["minimal", "moderate", "high"]
        },
        "accessibility": {
          "type": "object",
          "description": "Accessibility requirements",
          "properties": {
            "screen_reader": {
              "type": "boolean",
              "description": "Must support screen readers"
            },
            "high_contrast": {
              "type": "boolean",
              "description": "Must support high contrast mode"
            },
            "large_text": {
              "type": "boolean",
              "description": "Must support large text scaling"
            },
            "reduced_motion": {
              "type": "boolean",
              "description": "Must respect reduced motion preference"
            }
          }
        }
      }
    },
    "StackingConfig": {
      "type": "object",
      "description": "Configuration for stacking multiple lenses",
      "properties": {
        "allowed_combinations": {
          "type": "array",
          "description": "Allowed lens combinations (arrays of persona IDs)",
          "items": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "forbidden_combinations": {
          "type": "array",
          "description": "Forbidden lens combinations",
          "items": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "conflict_resolution": {
          "type": "string",
          "description": "How to resolve conflicts between stacked lenses",
          "enum": ["priority", "merge", "first", "last"],
          "default": "priority"
        },
        "priority_order": {
          "type": "array",
          "description": "Priority order for conflict resolution (first = highest)",
          "items": {
            "type": "string"
          }
        },
        "max_stack_depth": {
          "type": "integer",
          "description": "Maximum number of lenses that can be stacked",
          "default": 3
        }
      }
    }
  }
}
