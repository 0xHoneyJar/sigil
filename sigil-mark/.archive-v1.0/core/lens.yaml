# Sigil Core: Lens Registry
# HD and SD coexist without fighting.

lens:
  # ═══════════════════════════════════════════════════════════════════
  # PHILOSOPHY
  # ═══════════════════════════════════════════════════════════════════

  philosophy:
    insight: |
      OSRS solved the HD/SD divide beautifully:
      - Core game stays pixel-art (the soul)
      - 117HD is a LENS overlay (opt-in enhancement)
      - RuneLite adds utility overlays (additive)
      - Accessibility mode reduces motion (highest priority)

      The lesson: "NEVER bake lens features into core assets."
      Core is truth. Lens is experience.

    principle: |
      Multiple users experience the same product differently.
      This is not a bug. It's intentional.
      Lenses render the same underlying truth through different filters.

  # ═══════════════════════════════════════════════════════════════════
  # LENS DEFINITIONS
  # ═══════════════════════════════════════════════════════════════════

  layers:
    vanilla:
      id: "vanilla"
      name: "Vanilla"
      description: "Gold standard, core fidelity"
      priority: 0
      is_default: true
      constraints:
        can_modify:
          - colors
          - typography
          - spacing
          - motion
        cannot_modify:
          - layout_structure
          - component_geometry
          - interaction_patterns
          - information_hierarchy
      css_scope: ":root"
      activation: "default"

    high_fidelity:
      id: "high_fidelity"
      name: "High-Fidelity"
      description: "117HD style, enhanced visuals"
      priority: 10
      is_default: false
      constraints:
        can_modify:
          - textures
          - lighting
          - shadow_depth
          - gradient_complexity
        cannot_modify:
          - layout_structure
          - component_geometry
          - hitbox_sizes
          - interaction_timing
      css_scope: "[data-lens='high-fidelity']"
      activation: "user_preference"
      example: |
        Vanilla button: Solid color, subtle shadow
        HD button: Gradient, ambient occlusion, light bloom

    utility:
      id: "utility"
      name: "Utility"
      description: "RuneLite style, overlays and markers"
      priority: 20
      is_default: false
      constraints:
        behavior: "additive_only"
        can_add:
          - overlays
          - indicators
          - tooltips
          - markers
        cannot_modify:
          - existing_elements
          - core_styles
          - layout
        cannot_remove:
          - any_existing_content
      css_scope: "[data-lens='utility']"
      activation: "user_preference"
      example: |
        Adds: Keyboard shortcuts overlay
        Adds: Progress indicators
        Adds: Advanced tooltips
        Does NOT modify existing UI

    accessibility:
      id: "accessibility"
      name: "Accessibility"
      description: "High contrast, reduced motion"
      priority: 100
      is_default: false
      constraints:
        highest_priority: true
        overrides_all_other_lenses: true
        modifications:
          motion: "reduced"
          contrast: "high"
          focus_indicators: "enhanced"
          text_size: "scalable"
      css_scope: "[data-lens='accessibility']"
      activation: "system_preference_or_user"
      media_queries:
        - "(prefers-reduced-motion: reduce)"
        - "(prefers-contrast: more)"
        - "(forced-colors: active)"

  # ═══════════════════════════════════════════════════════════════════
  # CSS VARIABLE MAPPING
  # ═══════════════════════════════════════════════════════════════════

  css_variables:
    description: |
      Each lens can override CSS custom properties.
      Properties follow the pattern: --sigil-{category}-{property}

    categories:
      color:
        prefix: "--sigil-color"
        examples:
          - "--sigil-color-primary"
          - "--sigil-color-surface"
          - "--sigil-color-text"

      motion:
        prefix: "--sigil-motion"
        examples:
          - "--sigil-motion-duration-fast"
          - "--sigil-motion-duration-slow"
          - "--sigil-motion-easing-spring"

      space:
        prefix: "--sigil-space"
        examples:
          - "--sigil-space-xs"
          - "--sigil-space-md"
          - "--sigil-space-xl"

      shadow:
        prefix: "--sigil-shadow"
        examples:
          - "--sigil-shadow-sm"
          - "--sigil-shadow-md"
          - "--sigil-shadow-lg"

      radius:
        prefix: "--sigil-radius"
        examples:
          - "--sigil-radius-sm"
          - "--sigil-radius-md"
          - "--sigil-radius-full"

  # ═══════════════════════════════════════════════════════════════════
  # LENS RESOLUTION
  # ═══════════════════════════════════════════════════════════════════

  resolution:
    description: "How lenses are applied when multiple are active"

    order:
      1: "Start with vanilla (base)"
      2: "Apply high_fidelity if enabled"
      3: "Apply utility (additive)"
      4: "Apply accessibility (overrides all if active)"

    conflict_rules:
      - rule: "Accessibility always wins"
        example: "If accessibility reduces motion, HD cannot add it back"
      - rule: "Utility is always additive"
        example: "Utility overlays appear on top of any other lens"
      - rule: "HD cannot change geometry"
        example: "A button in HD is the same size as vanilla"

  # ═══════════════════════════════════════════════════════════════════
  # AGENT RULES
  # ═══════════════════════════════════════════════════════════════════

  agent_rules:
    core_principle: |
      NEVER bake lens features into core assets.
      Core is truth. Lens is experience.

    when_generating_components: |
      1. Generate for vanilla first (default experience)
      2. Use CSS custom properties for lens-variable values
      3. Add data attributes for lens targeting
      4. Test that component works without any lens

    when_adding_enhancement: |
      Is this enhancement CORE or LENS?

      CORE: All users need this to use the product
      LENS: Some users prefer this experience

      If LENS: Add to appropriate lens layer, not core

    when_user_requests_animation: |
      1. Implement for vanilla with standard timing
      2. Add reduced-motion fallback for accessibility
      3. If HD version requested, add as lens override
      4. Never require animation for functionality

    accessibility_priority: |
      Accessibility lens has HIGHEST priority.
      If user has reduced-motion preference:
      - All other lenses MUST respect it
      - No animation overrides allowed
      - Focus indicators enhanced, not removed
